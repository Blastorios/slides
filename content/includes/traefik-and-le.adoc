
= Traefik and Let's Encrypt

[{invert}]
== HTTPS & Let's Encrypt

image::traefik-lets-encrypt-diagram.png["Lets encrypt",width=1000]

[.notes]
--
The Automatic Certificate Management Environment

- Traefik derives the list of certificates it needs to load from its dynamic configuration
- Asks a certificate authority and passes challenges to prove that the webserver is behind the domain it asks for.
- That's the ACME protocol
- 3 types of challenges
--

[{invert}]
== Let's encrypt HTTP Challenge

image::lets-encrypt-http-challenge.png["Lets encrypt HTTP Challenge",width=1000]

[{invert}]
== HTTP-01 Pro and Cons

- ✅ Easy to understand

- ❌ Requires port 80 to be exposed publicly
- ❌ No wildcard certificates

[{invert}]
== Let's encrypt TLS-ALPN Challenge

image::lets-encrypt-tls-challenge.png["Lets encrypt TLS Challenge",width=1000]

[.notes]
--
- Same cinematic that HTTP-01
- On port 443
- Relies on TLS-ALPN : Application Layer Protocol Negociation to ensure that only host aware of this challenge answers
- Validation are SNI based:
--

[{invert}]
== TLS-ALPN-01 Pro and Cons

- ✅ More Secure

- ❌ Requires port 443 to be exposed publicly
- ❌ No wildcard certificates

[{invert}]
== Let's encrypt DNS Challenge

image::lets-encrypt-dns-challenge.png["Lets encrypt DNS Challenge",width=1000]

[{invert}]
== DNS-01 challenge Pro and Cons

- ✅ Supports wildcard certificates
- ✅ Works for non exposed instances

- ❌ Needs DNS provider with an API

== Certificate resolvers

static-config.toml
[source,toml]
----
# [...]
[certificatesResolvers.tls.acme]
  email = "your-email@your-domain.org"
  [certificatesResolvers.tls.acme.tlsChallenge]
----

app-route.yaml
[source,yaml]
----
---
apiVersion: traefik.containo.us/v1alpha1
kind: IngressRoute
metadata:
  name: blogtls
spec:
  # [...]
  routes:
  - match: Host(`company.com`) && Path(`/blog`)
  # [...]
  tls:
    certresolver: tls
----
