[{invert}]
= Agenda

* {agenda-acme}
* {agenda-rp}
* {agenda-web}
* **{agenda-ci}**
* {agenda-scm}
* {agenda-ws}

== Goal

* We want access to the CI hosted in Docker through Traefik in Kubernetes

== Challenge 1/2

* **Problem:** How to tell to Traefik to route requests to the CI which is not deloyed in Kubernetes?

[source,bash,subs="attributes+"]
----
https://{lab-domain}/jenkins
  -> Traefik Kubernetes
    -> Traefik Docker
      -> https://<Jenkins Private IP>/jenkins
----

== Headless Service

* **Solution:** Use (once again) a service linked to an external address

[source,yaml,indent=0,subs="attributes+"]
----
include::../../demo/lab-docker-k8s/02-k8s-traefik/jenkins/svc-ingress.yml[tag=svc]
----

== Challenge 2/2

* **Problem:** How to detect the HTTPS requests to catch ?

== Ingress Rule

* **Solution:**  Catch the resquests for the `Path: /jenkins`:

[source,yaml,indent=0,subs="attributes+"]
----
include::../../demo/lab-docker-k8s/02-k8s-traefik/jenkins/svc-ingress.yml[tag=ingress]
----

== Apply the configuration

[source,bash,subs="attributes"]
----
kubectl apply -f ./jenkins/svc-ingress.yml
----


[{invert}]
== Reality Check

link:https://{lab-domain}/jenkins[https://{lab-domain}/jenkins,window=_blank]

[.shadow]
image::after-jenkins-up.png[width=500]

It's good: we still can setup Jenkins!
